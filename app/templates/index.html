{% extends "base.html" %}

{% block content %}
<h1 class="title">Grading Tool</h1>

<form method="post">
    <div class="table-container">
        <table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth">
            <thead>
                <tr>
                    <th>Criteria</th>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>Weight (0 til 5)</th>
                </tr>
            </thead>
            <tbody>
                {% for criterion in criteria %}
                <tr>
                    <td>
                        <ul>
                            <li>
                                {{ criterion }}
                                <button onclick="editCriterion('{{ criterion }}', event)">✏️</button>
                                <button onclick="deleteCriterion('{{ criterion }}', event)">❌</button>
                            </li>
                        </ul>
                    </td>
                    {% for i in range(1, 7) %}
                    <td>
                        <input type="checkbox" name="{{ criterion }}" value="{{ i }}" onclick="onlyOne(this);">
                    </td>
                    {% endfor %}
                    <td>
                        <input class="input" type="number" name="{{ criterion }}_weight" min="0" max="5" step="1"
                            value="5">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="add-criterion">
            <button class="button is-primary" onclick="addNewCriterion(event)">+ Add new criterion</button>
        </div>
    </div>
    <div class="field">
        <div class="control has-text-centered">
            <button class="button is-primary" type="submit">Submit</button>
        </div>
    </div>
</form>

<script>
    function onlyOne(checkbox) {
        var checkboxes = document.getElementsByName(checkbox.name);
        checkboxes.forEach((item) => {
            if (item !== checkbox) item.checked = false;
        })
    }
    function editCriterion(criterion, event) {
        event.preventDefault();  // Prevent form submission
        var newCriterionName = prompt("Edit Criterion:", criterion);
        if (newCriterionName) {
            window.location.href = `/edit_criterion?old=${criterion}&new=${newCriterionName}`;
        }
    }

    function deleteCriterion(criterion, event) {
        event.preventDefault();  // Prevent form submission
        if (confirm("Are you sure you want to delete this criterion?")) {
            window.location.href = `/delete_criterion?name=${criterion}`;
        }
    }

    function addNewCriterion(event) {
        event.preventDefault();  // Prevent form submission
        var criterionName = prompt("Enter the name for the new criterion:");
        if (criterionName) {
            var form = document.createElement('form');
            form.method = 'post';
            form.action = '/add_criterion';

            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'new_criterion';
            input.value = criterionName;

            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }
    }


</script>


{% endblock %}